# AGENTS

## 役割分担
- 人間: 動画収集、イベントラベル作成、ROI preset 定義、公開範囲の最終判断。
- Codex: パイプライン実装、テスト、ツール、ドキュメント整備、再現性担保。
- 共同: モデル出力のレビュー、評価目標の合意、破壊的変更の承認。

## コーディング規約
- Python: 3.11 を基準にし、モジュールは `src/state2action_vision` に配置。
- 型: 公開APIは型注釈必須、設定は dataclass を推奨。
- 例外: 入力検証を早期に行い、`ValueError` または `RuntimeError` で明確に通知。
- ログ: `logging` を使い、キー付きで出力。CLI 進捗のみ `print` を許可。
- CLI: エントリポイントは `tools/` に集約。argparse を使い、失敗時は非0終了。
- ディレクトリ責務: `config` は preset/スキーマ、`dataset` は jsonl IO、`vision` は ROI/補助特徴、`learning` は学習、`inference` は推論/マスク、`utils` は共通。

## PR運用
- 変更は小さく単目的に分割し、テストとドキュメントを同時更新。
- 主要ロジックやデータIO変更時は `pytest` を実行。
- 破壊的変更は説明と移行手順を明記。
- `data/` の中身はコミットしない（例外は `data/README.md` のみ）。

## 版権/固有名詞ポリシー
- 一般化用語のみ使用（行動候補、候補UI、リソースゲージ、時間UI）。
- `assets/` に識別可能な素材や固有UI参照は置かない。
- raw動画とイベントラベルは非公開扱いとし、公開は匿名化済み集計のみ。

## 失敗しやすい点チェックリスト
- 解像度差による ROI ずれ。
- イベント時刻とフレームの同期ズレ。
- 連続操作時のラベルノイズ。
- 候補UIの可用性誤判定（無効状態の見落とし）。
- リソースゲージ推定の経時ドリフト。
- 時間UIの欠落や切り落とし。
- フレームドロップや可変FPS。
- action mask 未適用による無効提案。

## CI/テスト方針
- `pytest` を標準とし、`tests/` に軽量スモークテストを維持。
- 学習/データ生成は可能な限りシード固定で再現性を確保。
- CI は Linux で実行し、Windows 固有パスやシェル依存は避ける。
